<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* BASE STYLES */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 10px; font-size: 15px; }
        .container { width: 100%; max-width: 1000px; margin: 0 auto; background: white; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 8px; box-sizing: border-box; }
        
        /* HEADER */
        .college-header { text-align: center; border-bottom: 3px solid #b30000; padding-bottom: 15px; margin-bottom: 20px; }
        .college-header h1 { margin: 0; color: #b30000; font-size: 1.2rem; text-transform: uppercase; }
        .college-header h2 { margin: 5px 0; color: #333; font-size: 1rem; }
        .college-header p { font-style: italic; color: #666; font-size: 0.9rem; }
        
        /* SECTIONS & TABS */
        h2.section-title { background-color: #fff0f0; padding: 10px; border-left: 5px solid #b30000; margin-top: 25px; font-size: 1.1rem; color: #b30000; }
        h3 { color: #555; margin-top: 20px; border-bottom: 1px solid #ddd; padding-bottom: 5px; font-size: 1rem; }
        
        .tab-buttons { display: flex; overflow-x: auto; gap: 5px; margin-bottom: 15px; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .tab-btn { padding: 10px 15px; background: #eee; border: none; border-radius: 20px; font-weight: bold; white-space: nowrap; cursor: pointer; flex: 0 0 auto; }
        .tab-btn.active { background: #b30000; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* INPUTS & TABLES */
        input, textarea, select { font-size: 15px; padding: 8px; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 0.85rem; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: middle; }
        th { background-color: #f8f8f8; font-weight: bold; color: #444; }
        
        .summary-table td:last-child { width: 70px; text-align: center; }
        .summary-table input { text-align: center; font-weight: bold; margin: 0; }
        .subtotal-row { background-color: #444; color: white; font-weight: bold; }
        .subtotal-row td { color: white; }

        /* RESPONSIVE LOG TABLES */
        @media (max-width: 600px) {
            .log-table thead { display: none; }
            .log-table tr { display: block; margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
            .log-table td { display: block; border: none; padding: 5px 0; }
            .log-table td::before { content: attr(data-label); font-weight: bold; display: block; color: #999; font-size: 0.8em; text-transform: uppercase; }
        }

        /* BUTTONS */
        .btn-add { background: #008CBA; color: white; width: 100%; padding: 12px; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; margin-bottom: 10px; font-weight: bold; }
        .btn-del { background: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; }
        
        /* CLOUD ACTIONS */
        .cloud-actions { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-top: 30px; text-align: center; border: 1px solid #2196F3; }
        .cloud-btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; width: 100%; max-width: 200px; }
        .btn-save-cloud { background: #2196F3; color: white; }
        .btn-load-cloud { background: #673AB7; color: white; }
        
        /* PDF MODE */
        .show-for-pdf { display: block !important; }
        .pdf-mode .tab-buttons, .pdf-mode .cloud-actions, .pdf-mode .btn-add, .pdf-mode .btn-del { display: none !important; }
        .pdf-mode input, .pdf-mode textarea { border: none !important; background: transparent !important; padding: 0; resize: none; overflow: visible; font-size: 11px; font-family: serif; }
        .pdf-mode .container { box-shadow: none; border: none; }
    </style>
</head>
<body>

<div class="container" id="logbook-content">
    <div class="college-header">
        <h1>Goa Medical College</h1>
        <h2>Department of Neurosurgery</h2>
        <p>MCh Logbook (Hybrid Format)</p>
    </div>

    <div class="tab-buttons" data-html2canvas-ignore="true">
        <button class="tab-btn active" onclick="openTab('summary')">1. Summary</button>
        <button class="tab-btn" onclick="openTab('academics')">2. Academics</button>
        <button class="tab-btn" onclick="openTab('logs')">3. Daily Logs</button>
    </div>

    <div id="summary" class="tab-content active">
        
        <h2 class="section-title">A. Adult Procedures</h2>
        
        <h3>1. Cerebrovascular</h3>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 10]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>Aneurysm Clip (Anterior Circ)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Aneurysm Clip (Posterior Circ)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>AVM Excision</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Carotid Endarterectomy/Trapping</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Cavernoma Excision</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>EC-IC Bypass / Moya Moya</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Endovascular Procedure</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>ICH Evacuation</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>

        <h3>2. Tumour (Cranial)</h3>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 74]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>Glioma: Low Grade</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Glioma: High Grade</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Meningioma</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Pituitary (Trans-sphenoidal)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Pituitary (Trans-cranial)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Acoustic Neuroma / CP Angle</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Metastasis</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Intraventricular / Colloid Cyst</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Skull Base Approach</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Endoscopic Biopsy</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>

        <h3>3. Spine</h3>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 37]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>Discectomy (Cervical)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Discectomy (Lumbar/Thoracic)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Laminectomy (Stenosis)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Spinal Fusion (ACDF/TLIF/PLIF)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Spinal Tumour (Extradural)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Spinal Tumour (Intradural)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Spinal Trauma / Stabilization</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>CV Junction / Chiari Decompression</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>

        <h3>4. Trauma (Cranial)</h3>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 73]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>Acute Subdural (Craniotomy)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Chronic Subdural (Burr Hole)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Extradural Haematoma</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Decompressive Craniectomy</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Depressed Fracture</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Cranioplasty</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>
        
        <h3>5. Other (Functional/Infection/CSF)</h3>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 21, 27]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>VP Shunt / Revision</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>ETV / Ommaya</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Brain Abscess / Empyema</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Microvascular Decompression (MVD)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Stereotactic / Functional</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>

        <h2 class="section-title">B. Paediatric Procedures</h2>
        <table class="summary-table">
            [cite_start]<thead><tr><th>Procedure [cite: 82, 95]</th><th>Total</th></tr></thead>
            <tbody>
                <tr><td>Paediatric Tumour (Post Fossa)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Paediatric Tumour (Supratentorial)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Hydrocephalus (Shunt/ETV)</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Myelomeningocele / Dysraphism</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Craniosynostosis / Encephalocele</td><td><input type="number" class="sum-input"></td></tr>
                <tr><td>Paediatric Trauma</td><td><input type="number" class="sum-input"></td></tr>
                <tr class="subtotal-row"><td>Subtotal</td><td class="total-cell">0</td></tr>
            </tbody>
        </table>
    </div>

    <div id="academics" class="tab-content">
        <h2 class="section-title">Seminars / Journal Club</h2>
        <button class="btn-add" onclick="addRow('log-seminars')">+ Add Activity</button>
        <table class="log-table" id="log-seminars">
            <thead><tr><th style="width:25%">Date</th><th>Topic</th><th>Type</th><th style="width:10%">X</th></tr></thead>
            <tbody></tbody>
        </table>

        <h2 class="section-title">Case Presentations</h2>
        <button class="btn-add" onclick="addRow('log-cases')">+ Add Case</button>
        <table class="log-table" id="log-cases">
            <thead><tr><th style="width:30%">Topic</th><th>Faculty</th><th style="width:10%">X</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="logs" class="tab-content">
        <h2 class="section-title">Emergency Log</h2>
        <button class="btn-add" onclick="addRow('log-emergency')">+ Add Case</button>
        <table class="log-table" id="log-emergency">
            <thead><tr><th style="width:20%">Date</th><th style="width:25%">IP/Name</th><th>Dx & Procedure</th><th style="width:10%">X</th></tr></thead>
            <tbody></tbody>
        </table>

        <h2 class="section-title">Routine Log</h2>
        <button class="btn-add" onclick="addRow('log-routine')">+ Add Case</button>
        <table class="log-table" id="log-routine">
            <thead><tr><th style="width:20%">Date</th><th style="width:25%">IP/Name</th><th>Dx & Procedure</th><th style="width:10%">X</th></tr></thead>
            <tbody></tbody>
        </table>
        
        <h2 class="section-title">Endovascular Log</h2>
        <button class="btn-add" onclick="addRow('log-endo')">+ Add Case</button>
        <table class="log-table" id="log-endo">
            <thead><tr><th style="width:20%">Date</th><th style="width:25%">IP/Name</th><th>Dx & Procedure</th><th style="width:10%">X</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="cloud-actions" data-html2canvas-ignore="true">
        <h3>☁️ Cloud Sync</h3>
        <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
            <button class="cloud-btn btn-save-cloud" onclick="saveToCloud()">⬆ Save Data</button>
            <button class="cloud-btn btn-load-cloud" onclick="loadFromCloud()">⬇ Load Data</button>
        </div>
        <div id="status" style="margin-top:10px; font-weight:bold;"></div>
        <hr style="margin:20px 0; border:0; border-top:1px solid #ddd;">
        <button onclick="generatePDF()" style="background:#555; color:white; padding:12px; border:none; border-radius:5px; width:100%;">Download PDF Logbook</button>
    </div>
</div>

<script>
    // ==========================================
    // PASTE YOUR URL HERE
    // ==========================================
    const CLOUD_URL = "PASTE_YOUR_GOOGLE_APPS_SCRIPT_URL_HERE"; 

    // 1. Add Rows
    function addRow(tableId, data = {}) {
        const tbody = document.querySelector(`#${tableId} tbody`);
        const row = document.createElement('tr');
        
        let cells = '';
        if(tableId.includes('seminars')) {
            cells = `
                <td data-label="Date"><input type="date" class="save-input" value="${data.col1 || ''}"></td>
                <td data-label="Topic"><textarea class="save-input" placeholder="Topic">${data.col2 || ''}</textarea></td>
                <td data-label="Type"><select class="save-input"><option>Seminar</option><option>Journal</option></select></td>`;
            setTimeout(() => { if(data.col3) row.querySelectorAll('.save-input')[2].value = data.col3; }, 0);
        } else if (tableId.includes('cases')) {
             cells = `
                <td data-label="Topic"><textarea class="save-input" placeholder="Case Topic">${data.col1 || ''}</textarea></td>
                <td data-label="Faculty"><input type="text" class="save-input" placeholder="Dr. Name" value="${data.col2 || ''}"></td>`;
        } else {
            cells = `
                <td data-label="Date"><input type="date" class="save-input" value="${data.col1 || ''}"></td>
                <td data-label="IP/Name"><input type="text" class="save-input" placeholder="Name / IP" value="${data.col2 || ''}"></td>
                <td data-label="Dx/Proc"><textarea class="save-input" placeholder="Dx & Procedure">${data.col3 || ''}</textarea></td>`;
        }
        row.innerHTML = cells + `<td><button class="btn-del" onclick="this.closest('tr').remove()">Del</button></td>`;
        tbody.appendChild(row);
    }

    // 2. Tabs
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // 3. Totals
    function calcTotals() {
        document.querySelectorAll('.summary-table').forEach(table => {
            let total = 0;
            table.querySelectorAll('input').forEach(i => total += Number(i.value) || 0);
            table.querySelector('.total-cell').textContent = total;
        });
    }

    // 4. Cloud Logic
    function saveToCloud() {
        if(CLOUD_URL.includes("PASTE")) { alert("Paste your Google Script URL in the code!"); return; }
        const status = document.getElementById('status');
        status.textContent = "Syncing..."; status.style.color = "blue";
        
        const summaryData = [];
        document.querySelectorAll('.summary-table input').forEach(i => summaryData.push(i.value));
        
        const logData = {};
        ['log-seminars', 'log-cases', 'log-emergency', 'log-routine', 'log-endo'].forEach(id => {
            logData[id] = [];
            document.querySelectorAll(`#${id} tbody tr`).forEach(row => {
                const inputs = row.querySelectorAll('.save-input');
                logData[id].push({ col1: inputs[0]?.value, col2: inputs[1]?.value, col3: inputs[2]?.value });
            });
        });

        fetch(CLOUD_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "save", content: { summary: summaryData, logs: logData } }) })
        .then(() => { status.textContent = "✅ Saved!"; status.style.color = "green"; })
        .catch(err => { status.textContent = "❌ Error"; status.style.color = "red"; });
    }

    function loadFromCloud() {
        if(CLOUD_URL.includes("PASTE")) { alert("Paste URL first!"); return; }
        const status = document.getElementById('status');
        status.textContent = "Loading...";
        
        fetch(CLOUD_URL + "?action=get").then(res => res.json()).then(res => {
            if(res.status === "success") {
                const data = res.data;
                const sumInputs = document.querySelectorAll('.summary-table input');
                data.summary.forEach((val, i) => { if(sumInputs[i]) sumInputs[i].value = val; });
                calcTotals();
                for (const [id, rows] of Object.entries(data.logs)) {
                    document.querySelector(`#${id} tbody`).innerHTML = "";
                    rows.forEach(r => addRow(id, r));
                }
                status.textContent = "✅ Loaded!"; status.style.color = "green";
            } else { status.textContent = "⚠️ No Data"; }
        });
    }

    // 5. Init
    window.onload = function() {
        ['log-seminars', 'log-cases', 'log-emergency', 'log-routine', 'log-endo'].forEach(id => { if(!document.querySelector(`#${id} tbody tr`)) addRow(id); });
        document.querySelectorAll('.summary-table').forEach(t => t.addEventListener('input', calcTotals));
    }

    // 6. PDF
    function generatePDF() {
        const el = document.getElementById('logbook-content');
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('show-for-pdf'));
        document.body.classList.add('pdf-mode');
        document.querySelectorAll('textarea').forEach(ta => ta.style.height = (ta.scrollHeight+5)+"px");
        
        html2pdf().from(el).save('Hybrid_Logbook.pdf').then(() => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('show-for-pdf'));
            document.body.classList.remove('pdf-mode');
            document.querySelector('.tab-content.active').classList.add('show-for-pdf');
        });
    }
</script>
</body>
</html>
